# Admin Orders UI 스펙

이 문서는 **주문 관리** UI 스펙을 정의한다.

> **경로**: `/admin/orders`
> **권한**: 관리자 전용
> **관련 API**: `/api/orders` (이미 구현됨 ✅)

---

## 1. 페이지 개요

고객 주문을 조회하고 상태를 관리하는 페이지.

### 1.1 주요 기능
- 주문 목록 조회 (전체, 상태별, 기간별)
- 주문 상세 조회
- 주문 상태 변경
- 고객 정보 조회
- 디지털 상품 다운로드 링크 확인

---

## 2. 레이아웃 구조

```tsx
<AdminOrdersPage>
  <PageHeader title="주문 관리" />

  {/* 필터 */}
  <FilterBar>
    <Select label="상태" options={['전체', '입금대기', '입금확인', '제작중', '발송중', '완료']} />
    <DateRangePicker label="주문일" />
    <SearchInput placeholder="주문번호, 고객명, 이메일 검색" />
  </FilterBar>

  {/* 주문 목록 */}
  <OrdersTable />
</AdminOrdersPage>
```

---

## 3. 컴포넌트 상세

### 3.1 주문 테이블 (OrdersTable)

**컬럼:**
```
┌────────────────────────────────────────────────────────────────────────┐
│ 주문번호          │ 주문일    │ 고객명  │ 상품       │ 금액   │ 상태   │ 작업  │
├────────────────────────────────────────────────────────────────────────┤
│ ORD-20250115-001 │ 2025-01-15 │ 홍길동 │ 미루루 보... │ 10,000 │ 입금대기 │ [보기] │
│ ORD-20250115-002 │ 2025-01-15 │ 김철수 │ 키링       │ 5,000  │ 입금확인 │ [보기] │
└────────────────────────────────────────────────────────────────────────┘
```

**기능:**
- **정렬**: 주문일, 금액
- **필터**: 상태, 기간
- **검색**: 주문번호, 고객명, 이메일
- **페이지네이션**: 20개씩
- **상태별 색상**:
  - 입금대기: `yellow` (⚠️)
  - 입금확인: `green` (✅)
  - 제작중: `blue` (🔨)
  - 발송중: `purple` (📦)
  - 완료: `gray` (✓)

**액션:**
- **보기**: 주문 상세 페이지로 이동

### 3.2 주문 상세 페이지 (OrderDetailPage)

**경로:** `/admin/orders/[id]`

**UI:**
```
┌─────────────────────────────────────────────────────┐
│ 주문 상세                                            │
├─────────────────────────────────────────────────────┤
│                                                      │
│ [← 목록으로]                                         │
│                                                      │
│ 주문 번호: ORD-20250115-001                         │
│ 주문 상태: [Select: 입금대기 ▼]  [상태 변경]        │
│                                                      │
│ --- 주문 정보 ---                                   │
│ 주문일: 2025-01-15 10:00:00                         │
│ 총 금액: ₩10,000                                    │
│                                                      │
│ --- 고객 정보 ---                                   │
│ 이름: 홍길동                                         │
│ 이메일: user@example.com                            │
│ 전화번호: 010-1234-5678                             │
│                                                      │
│ --- 배송 정보 ---                                   │
│ 수령인: 홍길동                                       │
│ 연락처: 010-1234-5678                               │
│ 주소: 서울시 강남구 테헤란로 123                     │
│ 배송 메모: 문 앞에 놓아주세요                        │
│                                                      │
│ --- 주문 상품 ---                                   │
│ ┌──────────────────────────────────────┐            │
│ │ [IMG] 미루루 보이스팩 Vol.1           │            │
│ │       타입: 디지털 상품                │            │
│ │       가격: ₩10,000 × 1개             │            │
│ │       [다운로드 링크 생성]             │            │
│ └──────────────────────────────────────┘            │
│                                                      │
│ --- 이력 ---                                        │
│ 2025-01-15 10:00 - 주문 생성                        │
│ 2025-01-15 12:00 - 입금 확인 (관리자: admin@...)    │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**기능:**
- 주문 상태 변경
- 디지털 상품 다운로드 링크 생성
- 주문 이력 조회

### 3.3 주문 상태 변경 (OrderStatusChange)

**UI:**
```
┌───────────────────────────┐
│ 주문 상태 변경             │
├───────────────────────────┤
│                            │
│ 현재 상태: 입금대기        │
│                            │
│ 변경할 상태 *              │
│ [Select: 입금확인 ▼]      │
│                            │
│ 메모 (선택)                │
│ [Textarea]                 │
│                            │
│ [취소] [변경]              │
└───────────────────────────┘
```

**상태 플로우:**
```
PENDING (입금대기)
    ↓
PAID (입금확인)
    ↓
MAKING (제작중) - 실물 굿즈만
    ↓
SHIPPING (발송중) - 실물 굿즈만
    ↓
DONE (완료)
```

**API 호출:**
```ts
PATCH /api/orders/[id]
{
  "status": "PAID"
}
```

**자동 액션:**
- **PAID 전환 시**: 디지털 상품 다운로드 가능해짐
- **DONE 전환 시**: 로그 기록

### 3.4 다운로드 링크 생성 (DownloadLinkGenerator)

**UI:**
```
┌───────────────────────────┐
│ 다운로드 링크 생성         │
├───────────────────────────┤
│                            │
│ 상품: 미루루 보이스팩 Vol.1 │
│                            │
│ 유효 기간                  │
│ ( ) 10분                   │
│ (•) 1시간                  │
│ ( ) 24시간                 │
│                            │
│ [링크 생성]                │
│                            │
│ 생성된 링크:               │
│ [https://...] [복사]       │
│                            │
└───────────────────────────┘
```

**API 호출:**
```ts
GET /api/orders/[orderId]/items/[itemId]/download
→ Presigned URL 반환
```

---

## 4. 상태 관리

### 4.1 React Query Hooks

```ts
// 주문 목록
const { data: orders } = useQuery({
  queryKey: ['admin', 'orders', filters],
  queryFn: () => fetchAdminOrders(filters),
});

// 주문 상세
const { data: order } = useQuery({
  queryKey: ['admin', 'orders', orderId],
  queryFn: () => fetchOrderDetail(orderId),
});

// 주문 상태 변경
const updateOrderStatus = useMutation({
  mutationFn: ({ orderId, status }) => updateOrderStatusApi(orderId, status),
  onSuccess: () => {
    queryClient.invalidateQueries(['admin', 'orders']);
    toast.success('주문 상태가 변경되었습니다');
  },
});

// 다운로드 링크 생성
const generateDownloadLink = useMutation({
  mutationFn: ({ orderId, itemId }) => generateDownloadLinkApi(orderId, itemId),
  onSuccess: (data) => {
    navigator.clipboard.writeText(data.download_url);
    toast.success('다운로드 링크가 복사되었습니다');
  },
});
```

---

## 5. 필터 및 검색

### 5.1 FilterBar

**필터 옵션:**
- **상태**: 전체, 입금대기, 입금확인, 제작중, 발송중, 완료
- **기간**: 오늘, 최근 7일, 최근 30일, 직접 선택
- **검색**: 주문번호, 고객명, 이메일

**URL 쿼리 파라미터:**
```
/admin/orders?status=PENDING&dateFrom=2025-01-01&dateTo=2025-01-31&search=홍길동
```

---

## 6. 통계 요약 (StatsSummary)

**UI:**
```
┌─────────────────────────────────────────────┐
│ 📊 주문 통계 (이번 달)                       │
├─────────────────────────────────────────────┤
│ 입금대기: 5건 | 입금확인: 10건 | 완료: 20건  │
│ 총 매출: ₩850,000                           │
└─────────────────────────────────────────────┘
```

**데이터 소스:**
- `GET /api/logs/stats?eventType=order_status_changed`
- `GET /api/orders?dateFrom={thisMonth}`

---

## 7. 1차 MVP 범위

### 포함 ✅
- ✅ 주문 목록 조회 (테이블)
- ✅ 주문 상세 조회
- ✅ 주문 상태 변경
- ✅ 필터 및 검색
- ✅ 다운로드 링크 생성
- ✅ 주문 통계 요약

### 제외 ⏸️
- ⏸️ 주문 취소/환불
- ⏸️ 배송 추적
- ⏸️ 일괄 상태 변경
- ⏸️ 엑셀 다운로드
- ⏸️ 주문 메모 (관리자 전용)

---

## 8. 참고 문서

- Admin 메인: `/specs/ui/admin/index.md`
- Orders API: `/specs/api/server/routes/orders/index.md` ✅
- 공통 컴포넌트: `/specs/ui/common/`
